{
    "builders": [
        {
            "type": "qemu",
            "vm_name": "arch",
            "iso_url": "http://mirror.bytemark.co.uk/archlinux/iso/2016.08.01/archlinux-2016.08.01-dual.iso",
            "iso_checksum_url": "http://mirror.bytemark.co.uk/archlinux/iso/2016.08.01/sha1sums.txt",
            "iso_checksum_type": "sha1",
            "shutdown_command": "sudo poweroff",
            "ssh_username": "root",
            "ssh_password": "packer",
            "headless": true,
            "disk_size": 16384,
            "disk_interface": "virtio",
            "output_directory": "/tmp/build",
            "boot_wait": "2s",
            "boot_command": [
                "<enter><wait25s>",
                "passwd<enter>packer<enter>packer<enter>",
                "systemctl start sshd<enter><wait>"
            ],
            "qemuargs": [
                [ "-net", "nic,model=virtio" ],
                [ "-net", "bridge,br=br0" ]
            ]
        }
    ],
    "provisioners": [
        {
            "type": "file",
            "source": "scripts/",
            "destination": "/tmp"
        },
        {
            "type": "shell",
            "inline": "/tmp/vars setup.sh"
        },
        {
            "type": "shell",
            "inline": "/tmp/vars run-chroot vagrant-setup.sh"
        },
        {
            "type": "shell",
            "inline": "/tmp/vars run-chroot cleanup.sh"
        },
        {
            "type": "shell",
            "inline": "/tmp/vars sh -c 'ln -sfv /run/systemd/resolve/resolv.conf $MNT/etc/resolv.conf'"
        },
        {
            "type": "shell",
            "inline": "/tmp/vars sh -c 'sync && umount $MNT'"
        }
    ],
    "post-processors": [
        {
            "type": "vagrant",
            "output": "arch.box"
        }
    ]
}
